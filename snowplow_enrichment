{
    "schema": "iglu:com.snowplowanalytics.snowplow/javascript_script_config/jsonschema/1-0-0",
    "data": {
        "vendor": "com.snowplowanalytics.snowplow",
        "name": "javascript_script_config",
        "enabled": true,
        "parameters": {
            "script": "dmFyIGtleXMgPSBbDQogICAgWyJidXNpbmVzc191bml0IiwgInZhcmlhdGlvbl9udW1iZXIiLCAiY2FtcGFpZ25fdHlwZSJdLA0KICAgIFsia2V5d29yZF9jb2RlcyJdLA0KICAgIFsiZGVwYXJ0dXJlX25hbWUiLCAiZGVwYXJ0dXJlX3Bvc2l0aW9uX2ZrIiwgImRlcGFydHVyZV9jb3VudHJ5X25hbWUiXSwNCiAgICBbImFycml2YWxfbmFtZSIsICJhcnJpdmFsX3Bvc2l0aW9uX2ZrIiwgImFycml2YWxfY291bnRyeV9uYW1lIl0sDQogICAgWyJkaXN0YW5jZV9rbSJdLA0KICAgIFsibGFuZ3VhZ2UiLCAiZG9tYWluIl0sDQogICAgWyJtYXRjaF90eXBlIl0NCl07DQoNCnZhciBmaW5hbEtleXNTaXplID0gMDsNCg0KDQpmdW5jdGlvbiBwYXJzZVF1ZXJ5KHFzdHIpIHsNCiAgICB2YXIgcXVlcnkgPSB7fSwNCiAgICAgICAgYSA9IHFzdHIuc3Vic3RyKDEpLnNwbGl0KCcmJyk7DQogICAgaWYgKHFzdHIgIT0gIiIpIHsNCiAgICAgICAgZm9yICh2YXIgaSA9IDAsIGogPSBhLmxlbmd0aDsgaSA8IGo7IGkrKykgew0KICAgICAgICAgICAgdmFyIGIgPSBhW2ldLnNwbGl0KCc9Jyk7DQogICAgICAgICAgICBxdWVyeVtkZWNvZGVVUklDb21wb25lbnQoYlswXSldID0gZGVjb2RlVVJJQ29tcG9uZW50KGJbMV0gfHwgJycpOw0KICAgICAgICB9DQogICAgfQ0KICAgIHJldHVybiBxdWVyeTsNCn0NCg0KZnVuY3Rpb24gcGFyc2VBZEdyb3VwKGFkR3JvdXApIHsNCiAgICAvLyBmYXVsdCB0b2xlcmVudCBkYXRhIHN0cnVjdHVyZQ0KICAgIHZhciBncm91cHMgPSBhZEdyb3VwLnNwbGl0KCd8JyksDQogICAgICAgIGRhdGEgPSB7fTsNCg0KICAgIGZvciAodmFyIGkgPSAwLCBncm91cExlbmd0aCA9IGdyb3Vwcy5sZW5ndGg7IGkgPCBncm91cExlbmd0aDsgaSsrKSB7DQogICAgICAgIC8vIHByZXZlbnQgY3JlYXRpbmcgYW4gYXJyYXkgaWYgbGFzdCBjaGFyIGlzIGp1c3QgfA0KICAgICAgICBpZiAoaSAhPT0gKGdyb3Vwcy5sZW5ndGggLSAxKSkgew0KICAgICAgICAgICAgZmluYWxLZXlzU2l6ZSsrOw0KDQogICAgICAgICAgICAvLyBkbyBub3Qgc3BsaXQga2V5d29yZF9jb2Rlcw0KICAgICAgICAgICAgaWYgKGkgPT09IDEpIHsNCiAgICAgICAgICAgICAgICBkYXRhW2tleXNbaV1bMF1dID0gZ3JvdXBzW2ldLnRyaW0oKTsNCiAgICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAgICAgdmFyIHN1Ykdyb3VwID0gZ3JvdXBzW2ldLnRyaW0oKS5zcGxpdCgnXycpOw0KICAgICAgICAgICAgICAgIGZvciAodmFyIGogPSAwLCBzdWJHcm91cExlbmd0aCA9IHN1Ykdyb3VwLmxlbmd0aDsgaiA8IHN1Ykdyb3VwTGVuZ3RoOyBqKyspIHsNCiAgICAgICAgICAgICAgICAgICAgLy8gY29uZGl0aW9uIGlzIGZvciB0cmFzaGluZyBvdGhlciBrZXkgd29yZHMgYmVjYXVzZSBvZiBzdGF0aWMgc3RydWN0DQogICAgICAgICAgICAgICAgICAgIGogPCBrZXlzW2ldLmxlbmd0aCAmJiAoZGF0YVtrZXlzW2ldW2pdXSA9IHN1Ykdyb3VwW2pdLnRyaW0oKSk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQogICAgfQ0KICAgIHJldHVybiBkYXRhOw0KfQ0KDQovLyBUT0RPIHJlZmFjdG9yDQpmdW5jdGlvbiBwcm9jZXNzKGV2ZW50KSB7DQogICAgdmFyIHF1ZXJ5ID0gbmV3IFN0cmluZyhldmVudC5nZXRQYWdlX3VybHF1ZXJ5KCkpOw0KICAgIHZhciBxdWVyeU9iamVjdCA9IHBhcnNlUXVlcnkocXVlcnkpOw0KDQogICAgaWYgKE9iamVjdC5rZXlzKHF1ZXJ5T2JqZWN0KS5sZW5ndGgpIHsNCiAgICAgICAgLy8gdGVzdCB2YWxpZGl0eSAtIG9ubHkgdHJlYXQgaWYgYWxsIHV0bSBmaWVsZHMgYXJlIHByZXNlbnQNCiAgICAgICAgaWYgKHF1ZXJ5T2JqZWN0LmFkZ3JvdXAgJiYgcXVlcnlPYmplY3QudXRtX2NhbXBhaWduICYmIHF1ZXJ5T2JqZWN0LnV0bV9tZWRpdW0gJiYgcXVlcnlPYmplY3QudXRtX3NvdXJjZSAmJiBxdWVyeU9iamVjdC51dG1fdGVybSkgew0KICAgICAgICAgICAgdmFyIHNjaGVtYSA9IHBhcnNlQWRHcm91cChxdWVyeU9iamVjdC5hZGdyb3VwKTsNCiAgICAgICAgICAgIC8vIGJhc2ljIHNpemUgY2hlY2sNCiAgICAgICAgICAgIGlmIChrZXlzLmxlbmd0aCA9PT0gZmluYWxLZXlzU2l6ZSkgew0KICAgICAgICAgICAgICAgIHNjaGVtYS5tZWRpdW0gPSBxdWVyeU9iamVjdC51dG1fbWVkaXVtOw0KICAgICAgICAgICAgICAgIHNjaGVtYS5rZXl3b3JkcyA9IHF1ZXJ5T2JqZWN0LnV0bV90ZXJtOw0KICAgICAgICAgICAgICAgIHNjaGVtYS5jb3N0X21vZGVsID0gcXVlcnlPYmplY3QudXRtX3NvdXJjZTsNCiAgICAgICAgICAgICAgICBzY2hlbWEuY2FtcGFpZ25fbmFtZSA9IHF1ZXJ5T2JqZWN0LnV0bV9jYW1wYWlnbjsNCiAgICAgICAgICAgICAgICBzY2hlbWEuYWRncm91cF9uYW1lID0gcXVlcnlPYmplY3QuYWRncm91cA0KDQogICAgICAgICAgICAgICAgcmV0dXJuIFt7DQogICAgICAgICAgICAgICAgICAgIHNjaGVtYTogImlnbHU6Y29tLmdvZXVyby9zZW1fcGFyYW1ldGVyc19jb250ZXh0L2pzb25zY2hlbWEvMi0wLTEiLA0KICAgICAgICAgICAgICAgICAgICBkYXRhOiBzY2hlbWENCiAgICAgICAgICAgICAgICB9XTsNCiAgICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAgICAgcmV0dXJuIFtdOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgcmV0dXJuIFtdOw0KICAgICAgICB9DQogICAgfSBlbHNlIHsNCiAgICAgICAgcmV0dXJuIFtdOw0KICAgIH0NCn0NCg=="
        }
    }
}
