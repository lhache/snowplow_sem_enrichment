{
    "schema": "iglu:com.snowplowanalytics.snowplow/javascript_script_config/jsonschema/1-0-0",
    "data": {
        "vendor": "com.snowplowanalytics.snowplow",
        "name": "javascript_script_config",
        "enabled": true,
        "parameters": {
            "script": "ZnVuY3Rpb24gcGFyc2VRdWVyeShxc3RyKSB7DQogICAgdmFyIHF1ZXJ5ID0ge30sDQogICAgCWEgPSBxc3RyLnN1YnN0cigxKS5zcGxpdCgnJicpOw0KCWlmIChxc3RyICE9ICIiKSB7DQoJCWZvciAodmFyIGkgPSAwLCBqID0gYS5sZW5ndGg7IGkgPCBqOyBpKyspIHsNCiAgICAgICAgCXZhciBiID0gYVtpXS5zcGxpdCgnPScpOw0KICAgICAgICAJcXVlcnlbZGVjb2RlVVJJQ29tcG9uZW50KGJbMF0pXSA9IGRlY29kZVVSSUNvbXBvbmVudChiWzFdIHx8ICcnKTsNCiAgICAJfQkNCgl9DQogICAgcmV0dXJuIHF1ZXJ5Ow0KfQ0KDQpmdW5jdGlvbiBwYXJzZUFkR3JvdXAgKGFkR3JvdXApIHsNCgkvLyBmYXVsdCB0b2xlcmVudCBkYXRhIHN0cnVjdHVyZQ0KCXZhciB2YWx1ZXMgPSBbXSwNCgkJa2V5cyA9IFsNCiAgCQkJWyJidXNpbmVzc191bml0IiwgInZhcmlhdGlvbl9udW1iZXIiLCAiY2FtcGFpZ25fdHlwZSJdLA0KCQkgIAlbInN1cHBvcnRfd29yZF90eXBlIiwgInZhcmlhdGlvbl9pbmRleCJdLA0KCQkgIAlbImRlcGFydHVyZV9uYW1lIiwgImRlcGFydHVyZV9wb3NpdGlvbl9mayIsICJkZXBhcnR1cmVfY291bnRyeV9uYW1lIl0sDQoJCSAgCVsiYXJyaXZhbF9uYW1lIiwgImFycml2YWxfcG9zaXRpb25fZmsiLCAiYXJyaXZhbF9jb3VudHJ5X25hbWUiXSwNCgkJCVsibGFuZ3VhZ2UiLCAiZG9tYWluIl0sDQoJCSAgCVsibWF0Y2hfdHlwZSJdDQoJXSwNCglncm91cHMgPSBhZEdyb3VwLnNwbGl0KCd8JyksDQoJZGF0YSA9IHsic2VtX21pZF9mdWxsIjogYWRHcm91cH07DQoNCglmb3IgKHZhciBpID0gMCwgZ3JvdXBMZW5ndGggPSBncm91cHMubGVuZ3RoIDsgaSA8IGdyb3VwTGVuZ3RoIDsgaSArKykgew0KCSAgLy8gcHJldmVudCBjcmVhdGluZyBhbiBhcnJheSBpZiBsYXN0IGNoYXIgaXMganVzdCB8DQoJICBpZiAoZ3JvdXBzW2ldLmxlbmd0aCkgew0KCSAgICB2YXIgc3ViR3JvdXAgPSBncm91cHNbaV0udHJpbSgpLnNwbGl0KCdfJyk7DQoJICAgIHZhbHVlcy5wdXNoKG5ldyBBcnJheShrZXlzW2ldLmxlbmd0aCkpOw0KCSAgICANCgkgICAgZm9yICh2YXIgaiA9IDAsIHN1Ykdyb3VwTGVuZ3RoID0gc3ViR3JvdXAubGVuZ3RoIDsgaiA8IHN1Ykdyb3VwTGVuZ3RoIDsgaisrKSB7ICAgIA0KCSAgICAgIC8vIGNvbmRpdGlvbiBpcyBmb3IgdHJhc2hpbmcgb3RoZXIga2V5IHdvcmRzIGJlY2F1c2Ugb2Ygc3RhdGljIHN0cnVjdA0KCSAgICAgIGogPCBrZXlzW2ldLmxlbmd0aCAmJiAoZGF0YVtrZXlzW2ldW2pdXSA9IHN1Ykdyb3VwW2pdLnRyaW0oKSk7DQoJICAgIH0NCgkgIH0NCgl9DQoJcmV0dXJuIGRhdGE7DQp9DQoNCmZ1bmN0aW9uIHByb2Nlc3MoZXZlbnQpIHsNCiAgICB2YXIgcXVlcnkgPSBuZXcgU3RyaW5nKGV2ZW50LmdldFBhZ2VfdXJscXVlcnkoKSk7DQogICAgdmFyIHF1ZXJ5T2JqZWN0ID0gcGFyc2VRdWVyeShxdWVyeSk7DQoNCiAgICBpZiAoT2JqZWN0LmtleXMocXVlcnlPYmplY3QpLmxlbmd0aCkgew0KICAgIAkvLyB0ZXN0IHZhbGlkaXR5IC0gb25seSB0cmVhdCBpZiBhbGwgdXRtIGZpZWxkcyBhcmUgcHJlc2VudA0KCSAgICBpZiAocXVlcnlPYmplY3QuYWRncm91cCAmJiBxdWVyeU9iamVjdC51dG1fY2FtcGFpZ24gJiYgcXVlcnlPYmplY3QudXRtX21lZGl1bSAmJiBxdWVyeU9iamVjdC51dG1fc291cmNlICYmIHF1ZXJ5T2JqZWN0LnV0bV90ZXJtKSB7DQogICAgCQl2YXIgc2NoZW1hID0gcGFyc2VBZEdyb3VwKHF1ZXJ5T2JqZWN0LmFkZ3JvdXApfTsNCiAgICAJCXNjaGVtYS5tZWRpdW0gPSBxdWVyeU9iamVjdC51dG1fbWVkaXVtOw0KICAgIAkJc2NoZW1hLmtleXdvcmRzID0gcXVlcnlPYmplY3QudXRtX3Rlcm07DQogICAgCQlzY2hlbWEuY29zdF9tb2RlbCA9IHF1ZXJ5T2JqZWN0LnV0bV9zb3VyY2U7DQogICAgCQlzY2hlbWEuY2FtcGFpZ25fbmFtZSA9IHF1ZXJ5T2JqZWN0LnV0bV9jYW1wYWlnbjsNCiAgICAJCXNjaGVtYS5hZGdyb3VwX25hbWUgPSBxdWVyeU9iamVjdC5hZGdyb3VwDQoNCgkJCXJldHVybiBbIHsgc2NoZW1hOiAiaWdsdTpjb20uZ29ldXJvL3NlbV9wYXJhbWV0ZXJzX2NvbnRleHQvanNvbnNjaGVtYS8yLTAtMCIsDQoJICAgICAgICAgICAgICAgZGF0YTogc2NoZW1hfSBdOw0KCSAgICB9DQoJICAgIGVsc2Ugew0KCSAgICAJcmV0dXJuIFtdOw0KCSAgICB9CQ0KICAgIH0NCiAgICBlbHNlIHsNCiAgICAJcmV0dXJuIFtdOw0KICAgIH0NCn0="
        }
    }
}
